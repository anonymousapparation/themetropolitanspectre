<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Page 1</title>
    <style>
        html, body {
            margin: 0;
            padding: 0;
            width: 100%;
            height: 100%; /* Ensure full height for positioning */
            box-sizing: border-box; /* Include padding and border in element's total width and height */
        }
        
        nav {
            background-color: #333;
            padding: 10px 0;
            text-align: center;
            width: 100%;
            box-sizing: border-box;
        }
        
        nav ul {
            list-style-type: none;
            margin: 0;
            padding: 0;
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            row-gap: 10px;
        }
        
        nav ul li {
            margin: 0 5px;
        }
        
        nav ul li a {
            text-decoration: none;
            color: white;
            background-color: #007bff;
            padding: 8px 15px;
            border-radius: 5px;
            display: inline-block;
            font-weight: bold;
            font-size: 14px;
        }
        
        nav ul li a:hover {
            background-color: #0056b3;
        }
        
        .header-container {
            text-align: center;
            margin: 20px auto;
            max-width: 90%;
        }
        
        .header-container h1, .header-container h3, .header-container p {
            margin: 20px 0;
            padding: 0 10px;
        }
        
        .header-container img {
            max-width: 100%;
            height: auto;
            display: block;
            margin: 0 auto;
        }
        .image-container {
            position: relative;
            width: 80%;
            max-width: 800px;
            margin: 20px auto; /* Add margin to center the container */
        }
        
        #uploadedImage {
            display: block;
            width: 100%;
            height: auto;
        }
        
        .overlay-image {
            position: absolute;
            opacity: 0.5;
            pointer-events: none;
            display: none;
        }
        
        .bottom-button-container {
            bottom: 50px; /* Space from the bottom */
            text-align: center; /* Center button text */
            display: flex;
            justify-content: center; /* Center the button horizontally */
            margin: 20px auto; /* Add margin for spacing from other content */
            width: 100%;
        }
        
        #navigateButton {
            padding: 10px 20px;
            background-color: #007bff;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 16px;
            font-weight: bold;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        }
        
        #navigateButton:hover {
            background-color: #0056b3;
        }

        #numberInput {
            padding: 10px;
            font-size: 16px;
            width: 50%;
            margin: 20px 0;
        }

    </style>
</head>
<body>
    <nav>
        <ul>
            <li><a href="index.html">Home</a></li>
            <li><a href="map.html">Map</a></li>
            <li><a href="upload.html">Upload</a></li>
        </ul>
    </nav>
    
    <h3>First, enter the entity number code and upload your picture below for analysis</h3>
    <input type="number" id="numberInput" placeholder="Enter entity number code..." min="1" max="3">
    <h3><br></h3>
    <input type="file" id="imageUpload" accept="image/*">
    <div id="imageContainer" class="image-container">
        <!-- User-uploaded image will be displayed here -->
        <img id="uploadedImage" alt="Uploaded Image">
        <!-- Overlay image -->
        <img id="overlayImage" class="overlay-image" src="https://static.vecteezy.com/system/resources/previews/026/979/903/non_2x/watercolor-realictic-victorian-ghost-vintage-style-illustration-gothic-shadow-clipart-isolated-on-white-background-png.png" alt="Overlay Image">
    </div>

    <h3><br><br>Next, submit your final image and complete the straightforward questionnaire</h3>
    <div class="bottom-button-container">
        <button id="navigateButton" onclick="navigateToPage()">Submit Image</button>
    </div>

    <h3><br></h3>

    <script type="text/javascript" src="https://cdn.jsdelivr.net/npm/@emailjs/browser@4/dist/email.min.js"></script>
    <script>
        emailjs.init('UtnJKJLyBH8Q4oCxW'); // 0xTkNhNb-YOtimykg
        
        const imageUpload = document.getElementById('imageUpload');
        const uploadedImage = document.getElementById('uploadedImage');
        const overlayImage = document.getElementById('overlayImage');
        const imageContainer = document.getElementById('imageContainer');

        let triedUploading = false; // Flag to track if user tried uploading after entering 2

        imageUpload.addEventListener('change', function(event) {
            const numberInput = document.getElementById('numberInput').value;

            if (numberInput === '109' && !triedUploading) {
                alert('No entity was spotted in your picture.');
                triedUploading = true; // Set the flag to indicate they have tried uploading
                imageUpload.value = ''; // Clear the input for the user to try again
            } else {
                const file = event.target.files[0];
                if (file) {
                    const reader = new FileReader();
                    reader.onload = function(e) {
                        uploadedImage.src = e.target.result;
                        uploadedImage.style.display = 'block';

                        uploadedImage.onload = function() {
                            overlayImage.style.display = 'block';

                            const overlayScale = 0.3 + Math.random() * (0.8 - 0.3);
                            overlayImage.style.width = uploadedImage.width * overlayScale + 'px';
                            overlayImage.style.height = 'auto';

                            const maxLeft = uploadedImage.width - overlayImage.clientWidth;
                            const maxTop = uploadedImage.height - overlayImage.clientHeight;
                            const randomLeft = Math.random() * maxLeft;
                            const randomTop = Math.random() * maxTop;

                            overlayImage.style.left = randomLeft + 'px';
                            overlayImage.style.top = randomTop + 'px';

                            imageContainer.style.width = uploadedImage.width + 'px';
                            imageContainer.style.height = uploadedImage.height + 'px';
                        };
                    };
                    reader.readAsDataURL(file);
                }
            }
        });

        //function navigateToPage() {
            //window.location.href = 'https://anonymousapparation.github.io/themetropolitanspectre/questionnaire.html'; // Replace with your target URL
        //}

        function navigateToPage() {
            const numberInput = document.getElementById('numberInput').value;
            let targetUrl;

            // Set target URL based on the input number
            switch (numberInput) {
                case '109':
                    targetUrl = 'questionnaire.html'; //boss thanks 1
                    break;
                case '042':
                    targetUrl = 'questionnaire1.html'; //boss thanks 1, anon threat 1
                    break;
                case '078':
                    targetUrl = 'questionnaire.html'; //boss thanks 1
                    break;
                case '295':
                    targetUrl = 'questionnaire2.html'; // boss thanks 1, anon threat 2
                    break;
                case '022':
                    targetUrl = 'questionnaire.html'; // boss thanks 1
                    break;
                case '999':
                    emailjs.send("boss", "1")
                        .then(function(response) {
                            console.log('Email sent successfully!', response);
                            window.location.href = 'submitted1.html'; // Redirect only after sending email
                        })
                        .catch(function(error) {
                            console.error('Failed to send email:', error);
                            alert('Error.');
                        });
                    return; // Prevent further execution
                default:
                    alert('Invalid Entity Number Code');
                    return;
            }

            window.location.href = targetUrl;
        }
    </script>
</body>
</html>
